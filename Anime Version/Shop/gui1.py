
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path

# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage
import subprocess
import ujson
import csv
import random
import sys
import os

current_dir = os.path.dirname(os.path.abspath(__file__))

project_root = os.path.abspath(os.path.join(current_dir, '../../'))

sys.path.insert(0, project_root)

import thesystem.system
import thesystem.shop

subprocess.Popen(['python', 'Files/Mod/default/sfx.py'])

OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"assets\frame1")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)


window = Tk()

window.geometry("475x163")
window.configure(bg = "#2D2D2D")
window.attributes('-alpha',0.9)
window.overrideredirect(True)
window.wm_attributes("-topmost", True)

with open("Files/Player Data/Status.json", 'r') as read_status_file:
    read_status_file_data=ujson.load(read_status_file)
    coins=read_status_file_data["status"][0]['coins']

thesystem.system.center_window(window,475,163)

def ex_close(win):
    win.quit()

desc1=desc2=''
segments = []
segment_length = 77

with open("Files/Temp Files/Shop Temp.csv", 'r') as csv_open:
    fr=csv.reader(csv_open)
    for k in fr:
        name=k[0]
        cat=k[1]
        rank=k[2]
        if cat!='QUEST':
            desc=k[3]
            for i in range(0, len(desc), segment_length):
                segments.append(desc[i:i+segment_length])
            if len(segments) >= 1:
                desc1 = segments[0]
            if len(segments) >= 2:
                desc2 = segments[1]
        else:
            desc1='Quest Given to one by the System'
            desc2=''
        value=k[4]

def shop_check(name,rank,val):
    if coins>=int(val):
        split_name=(name.split()[2])
        if split_name=="Quest":
            thesystem.shop.quests_add(rank,val,read_status_file_data, window)

canvas = Canvas(
    window,
    bg = "#2D2D2D",
    height = 163,
    width = 475,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

def start_move(event):
    window.lastx, window.lasty = event.widget.winfo_pointerxy()

def move_window(event):
    x_root, y_root = event.widget.winfo_pointerxy()
    deltax, deltay = x_root - window.lastx, y_root - window.lasty

    if deltax != 0 or deltay != 0:  # Update only if there is actual movement
        window.geometry(f"+{window.winfo_x() + deltax}+{window.winfo_y() + deltay}")
        window.lastx, window.lasty = x_root, y_root



canvas.place(x = 0, y = 0)
image_image_1 = PhotoImage(
    file=relative_to_assets("image_1.png"))
image_1 = canvas.create_image(
    81.0,
    87.0,
    image=image_image_1
)

canvas.create_rectangle(
    121.0,
    50.0,
    139.0,
    68.0,
    fill="#585858",
    outline="")

canvas.create_text(
    147.0,
    32.0,
    anchor="nw",
    text="Would you like to Purchase",
    fill="#FFFFFF",
    font=("Montserrat Regular", 15 * -1)
)

canvas.create_text(
    147.0,
    49.0,
    anchor="nw",
    text=f"[{name}]",
    fill="#FFFFFF",
    font=("Montserrat Bold", 16 * -1)
)

canvas.create_text(
    147.0,
    70.0,
    anchor="nw",
    text=f"{rank}-Rank",
    fill="#FFFFFF",
    font=("Montserrat Medium", 12 * -1)
)

canvas.create_text(
    147.0,
    85.0,
    anchor="nw",
    text=desc1,
    fill="#FFFFFF",
    font=("Montserrat Regular", 10 * -1)
)

canvas.create_text(
    147.0,
    97.0,
    anchor="nw",
    text=desc2,
    fill="#FFFFFF",
    font=("Montserrat Regular", 10 * -1)
)

canvas.create_text(
    124.0,
    50.0,
    anchor="nw",
    text="1",
    fill="#FFFFFF",
    font=("Montserrat Bold", 15 * -1)
)

canvas.create_text(
    305.0,
    110.0,
    anchor="nw",
    text="Value:",
    fill="#FFFFFF",
    font=("Montserrat Bold", 12 * -1)
)

canvas.create_rectangle(
    345.0,
    112.0,
    409.0,
    124.0,
    fill="#1B1B1B",
    outline="")

canvas.create_text(
    346.0,
    112.0,
    anchor="nw",
    text=value,
    fill="#FFFFFF",
    font=("Montserrat Regular", 10 * -1)
)

button_image_1 = PhotoImage(
    file=relative_to_assets("button_1.png"))
button_1 = Button(
    image=button_image_1,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: shop_check(name,rank,value),
    relief="flat"
)
button_1.place(
    x=370.0,
    y=134.0,
    width=92.0,
    height=16.0
)

image_0=canvas.create_rectangle(
    0.0,
    0.0,
    500.0,
    35.0,
    fill="#212121",
    outline="")

canvas.tag_bind(image_0, "<ButtonPress-1>", start_move)
canvas.tag_bind(image_0, "<B1-Motion>", move_window)

button_image_0 = PhotoImage(
    file=relative_to_assets("button_0.png"))
button_0 = Button(
    image=button_image_0,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: ex_close(window),
    relief="flat"
)
button_0.place(
    x=440.0,
    y=3.0,
    width=28.0,
    height=28.0
)

window.resizable(False, False)
window.mainloop()
